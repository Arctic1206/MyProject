<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ›åšè·‘é…·QTEç©æ³•éªŒè¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c2e, #1a1a3e);
            color: #e0e0ff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid #3a3a7a;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #6ee2ff;
            text-shadow: 0 0 10px rgba(110, 226, 255, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0ff;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .section {
            background: rgba(30, 30, 60, 0.7);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #4a4a8a;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #8a8aff;
            border-bottom: 1px solid #4a4a8a;
            padding-bottom: 8px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .input-card {
            background: rgba(40, 40, 80, 0.8);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid #5a5aaa;
        }
        
        .input-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(90, 90, 170, 0.3);
        }
        
        .key-display {
            font-size: 2rem;
            font-weight: bold;
            color: #6ee2ff;
            margin: 10px 0;
            text-shadow: 0 0 8px rgba(110, 226, 255, 0.7);
        }
        
        .action-name {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .action-desc {
            font-size: 0.9rem;
            color: #b0b0ff;
        }
        
        .output-area {
            min-height: 200px;
            background: rgba(20, 20, 40, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #4a4a8a;
            font-family: monospace;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #3a3a6a;
        }
        
        .log-time {
            color: #8a8aff;
            margin-right: 10px;
        }
        
        .log-success {
            color: #6eff8a;
        }
        
        .log-failure {
            color: #ff6e6e;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(30, 30, 60, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #4a4a8a;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6ee2ff;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        .qte-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(20, 20, 40, 0.8);
            border-radius: 10px;
            border: 2px solid #5a5aaa;
        }
        
        .qte-prompt {
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .qte-timer {
            width: 100%;
            height: 10px;
            background: rgba(60, 60, 100, 0.5);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .qte-timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #6ee2ff, #8a8aff);
            width: 100%;
            transition: width 0.1s linear;
        }
        
        .qte-requirements {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .qte-requirement {
            padding: 5px 10px;
            background: rgba(80, 80, 160, 0.7);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .qte-mash-counter {
            font-size: 1.2rem;
            margin: 10px 0;
            color: #ffcc66;
        }
        
        .qte-hold-progress {
            width: 80%;
            height: 10px;
            background: rgba(60, 60, 100, 0.5);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .qte-hold-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffcc66, #ffaa33);
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .qte-combo-sequence {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .qte-combo-key {
            padding: 8px 12px;
            background: rgba(80, 80, 160, 0.7);
            border-radius: 5px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
        
        .qte-combo-key.active {
            background: rgba(110, 226, 255, 0.8);
            color: #0c0c2e;
        }
        
        .qte-combo-key.completed {
            background: rgba(110, 255, 138, 0.8);
            color: #0c0c2e;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6ee2ff, #8a8aff);
            border: none;
            border-radius: 5px;
            color: #0c0c2e;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(110, 226, 255, 0.4);
        }
        
        button:disabled {
            background: #5a5a8a;
            color: #8a8aaa;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(40, 40, 80, 0.7);
            border-radius: 8px;
        }
        
        .level-stat {
            text-align: center;
        }
        
        .level-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffcc66;
        }
        
        .level-label {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        .enemy-display, .trap-display {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(40, 40, 80, 0.7);
            border-radius: 10px;
            border: 1px solid #5a5aaa;
        }
        
        .enemy-icon, .trap-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .enemy-icon {
            background: linear-gradient(135deg, #ff6e6e, #ff3333);
            box-shadow: 0 0 10px rgba(255, 110, 110, 0.5);
        }
        
        .trap-icon {
            background: linear-gradient(135deg, #ffcc66, #ffaa33);
            box-shadow: 0 0 10px rgba(255, 204, 102, 0.5);
        }
        
        .enemy-info, .trap-info {
            flex: 1;
        }
        
        .enemy-name, .trap-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .enemy-name {
            color: #ff9999;
        }
        
        .trap-name {
            color: #ffcc66;
        }
        
        .enemy-desc, .trap-desc {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .enemy-desc {
            color: #ccaaaa;
        }
        
        .trap-desc {
            color: #ccbb99;
        }
        
        .enemy-health {
            width: 100px;
            height: 10px;
            background: rgba(60, 60, 100, 0.5);
            border-radius: 5px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .enemy-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6e6e, #ff3333);
            width: 100%;
            transition: width 0.3s;
        }
        
        .environment-effects {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .environment-effect {
            padding: 5px 10px;
            background: rgba(80, 80, 160, 0.7);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .combo-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 60, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #5a5aaa;
            text-align: center;
            z-index: 100;
        }
        
        .combo-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6ee2ff;
        }
        
        .combo-label {
            font-size: 0.8rem;
            color: #a0a0ff;
        }
        
        .combo-multiplier {
            color: #ffcc66;
            font-weight: bold;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #3a3a6a;
        }
        
        .stat-name {
            color: #a0a0ff;
        }
        
        .stat-value {
            color: #6ee2ff;
            font-weight: bold;
        }
        
        .damage-popup {
            position: absolute;
            color: #ff6e6e;
            font-weight: bold;
            font-size: 1.2rem;
            animation: floatUp 1s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
        
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 30, 60, 0.95);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffcc66;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(255, 204, 102, 0.5);
            animation: achievementAppear 0.5s ease-out;
        }
        
        @keyframes achievementAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #ffcc66;
        }
        
        .achievement-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffcc66;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            font-size: 1rem;
            color: #e0e0ff;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: rgba(40, 40, 80, 0.7);
            border-radius: 8px;
            font-size: 0.9rem;
            color: #b0b0ff;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>èµ›åšè·‘é…·QTEç©æ³•éªŒè¯</h1>
            <div class="subtitle">æ ¸å¿ƒé€»è¾‘å±•ç¤º</div>
        </header>
        
        <div class="combo-counter">
            <div class="combo-value" id="combo-count">0</div>
            <div class="combo-label">è¿å‡»</div>
            <div class="combo-multiplier" id="combo-multiplier">x1.0</div>
        </div>
        
        <div class="game-area">
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="score">0</div>
                    <div class="status-label">åˆ†æ•°</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="health">3</div>
                    <div class="status-label">ç”Ÿå‘½å€¼</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="time">60</div>
                    <div class="status-label">å‰©ä½™æ—¶é—´</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="skill-uses">0</div>
                    <div class="status-label">æŠ€èƒ½ä½¿ç”¨</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="level">1</div>
                    <div class="status-label">å…³å¡</div>
                </div>
            </div>
            
            <div class="section">
                <div class="level-info">
                    <div class="level-stat">
                        <div class="level-value" id="qte-count">0</div>
                        <div class="level-label">QTEæ€»æ•°</div>
                    </div>
                    <div class="level-stat">
                        <div class="level-value" id="qte-completed">0</div>
                        <div class="level-label">å·²å®Œæˆ</div>
                    </div>
                    <div class="level-stat">
                        <div class="level-value" id="qte-type">-</div>
                        <div class="level-label">å½“å‰ç±»å‹</div>
                    </div>
                    <div class="level-stat">
                        <div class="level-value" id="qte-difficulty">ç®€å•</div>
                        <div class="level-label">éš¾åº¦</div>
                    </div>
                </div>
                
                <div id="environment-display">
                    <!-- è¿™é‡Œå°†æ˜¾ç¤ºæ•Œäººæˆ–é™·é˜± -->
                </div>
                
                <h2 class="section-title">å½“å‰QTEæŒ‘æˆ˜</h2>
                <div class="qte-display" id="qte-display">
                    <div class="qte-prompt" id="qte-prompt">ç­‰å¾…QTEç”Ÿæˆ...</div>
                    <div class="qte-timer">
                        <div class="qte-timer-fill" id="qte-timer-fill"></div>
                    </div>
                    <div id="qte-specific-display">
                        <!-- è¿™é‡Œå°†æ ¹æ®QTEç±»å‹æ˜¾ç¤ºä¸åŒçš„UI -->
                    </div>
                </div>
                
                <div class="stats-panel">
                    <div class="stat-item">
                        <span class="stat-name">æ•Œäººå‡»è´¥:</span>
                        <span class="stat-value" id="enemies-defeated">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-name">é™·é˜±é€šè¿‡:</span>
                        <span class="stat-value" id="traps-passed">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-name">æœºå…³æ¿€æ´»:</span>
                        <span class="stat-value" id="mechanisms-activated">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-name">æœ€é«˜è¿å‡»:</span>
                        <span class="stat-value" id="max-combo">0</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="start-level">å¼€å§‹å…³å¡</button>
                    <button id="next-level" disabled>ä¸‹ä¸€å…³å¡</button>
                    <button id="use-skill">ä½¿ç”¨å­å¼¹æ—¶é—´ (å‰©ä½™: <span id="skill-count">3</span>)</button>
                </div>
                
                <div class="instructions">
                    <strong>æ¸¸æˆè¯´æ˜:</strong> ä½¿ç”¨é”®ç›˜æŒ‰é”®å®ŒæˆQTEæŒ‘æˆ˜ã€‚ç©ºæ ¼é”®è·³è·ƒï¼ŒSé”®æ»‘é“²ï¼ŒJé”®æ”»å‡»ï¼ŒDé”®å†²åˆºï¼ŒShifté”®ä½¿ç”¨å­å¼¹æ—¶é—´æŠ€èƒ½ã€‚æ³¨æ„ï¼šç©ºæ ¼é”®ä¸ä¼šå¯¼è‡´é¡µé¢æ»šåŠ¨ã€‚
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">QTEè¾“å…¥ç³»ç»Ÿ</h2>
                <div class="input-grid" id="input-grid">
                    <!-- è¾“å…¥å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">æ¸¸æˆè¾“å‡ºæ—¥å¿—</h2>
                <div class="output-area" id="output-log">
                    <!-- æ—¥å¿—æ¡ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¾“å…¥é…ç½®æ•°æ®
        const inputConfig = [
            {
                key: 'Space',
                name: 'è·³è·ƒ',
                description: 'èº²é¿åœ°é¢é™·é˜±å’Œéšœç¢ç‰©',
                type: 'action'
            },
            {
                key: 'S',
                name: 'æ»‘é“²',
                description: 'èº²é¿ä½ç©ºéšœç¢å’Œæ”»å‡»',
                type: 'action'
            },
            {
                key: 'J',
                name: 'æ”»å‡»',
                description: 'å‡»è´¥æ•Œäººå’Œç ´åéšœç¢',
                type: 'action'
            },
            {
                key: 'D',
                name: 'å†²åˆº',
                description: 'å¿«é€Ÿç§»åŠ¨èº²é¿å±é™©',
                type: 'action'
            },
            {
                key: 'Shift',
                name: 'å­å¼¹æ—¶é—´',
                description: 'å‡æ…¢æ—¶é—´ï¼Œæ›´å®¹æ˜“å®ŒæˆQTE',
                type: 'skill'
            }
        ];

        // QTEç±»å‹å®šä¹‰
        const qteTypes = {
            CLICK: {
                name: 'å•å‡»',
                timeWindow: { min: 1.0, max: 1.5 },
                description: 'åœ¨æ—¶é—´çª—å£å†…å•æ¬¡æŒ‰ä¸‹æ­£ç¡®æŒ‰é”®',
                weight: 40
            },
            MASH: {
                name: 'è¿æ‰“',
                timeWindow: { min: 2.0, max: 2.5 },
                description: 'åœ¨æ—¶é—´çª—å£å†…å¿«é€ŸæŒ‰ä¸‹æŒ‡å®šæ¬¡æ•°',
                weight: 25,
                requirements: { min: 5, max: 7 }
            },
            HOLD: {
                name: 'é•¿æŒ‰',
                timeWindow: { min: 1.5, max: 2.0 },
                description: 'æŒç»­æŒ‰ä½æŒ‰é”®ç›´åˆ°è¿›åº¦æ¡å¡«æ»¡',
                weight: 20,
                requirements: { min: 0.8, max: 1.2 }
            },
            COMBO: {
                name: 'ç»„åˆé”®',
                timeWindow: { min: 2.5, max: 3.0 },
                description: 'æŒ‰é¡ºåºæŒ‰ä¸‹å¤šä¸ªæŒ‰é”®',
                weight: 15,
                requirements: { min: 2, max: 3 }
            }
        };

        // æ•Œäººç±»å‹å®šä¹‰
        const enemyTypes = {
            DRONE: {
                name: 'å°å‹æ— äººæœº',
                health: 1,
                qteType: 'CLICK',
                score: 10,
                description: 'åŸºç¡€çš„ç©ºä¸­å•ä½ï¼Œéœ€è¦å¿«é€Ÿååº”',
                icon: 'ğŸš'
            },
            ROBOT: {
                name: 'é˜²å¾¡æœºå™¨äºº',
                health: 2,
                qteType: 'MASH',
                score: 20,
                description: 'åšå›ºçš„é˜²å¾¡å•ä½ï¼Œéœ€è¦è¿ç»­æ”»å‡»',
                icon: 'ğŸ¤–'
            },
            GUARD: {
                name: 'ç²¾è‹±å®ˆå«',
                health: 3,
                qteType: 'COMBO',
                score: 30,
                description: 'é«˜çº§æˆ˜æ–—å•ä½ï¼Œéœ€è¦ç²¾ç¡®çš„è¿æ‹›',
                icon: 'ğŸ’‚'
            }
        };

        // é™·é˜±ç±»å‹å®šä¹‰
        const trapTypes = {
            LASER: {
                name: 'æ¿€å…‰æ …æ ',
                qteType: 'CLICK',
                damage: 1,
                description: 'éœ€è¦è·³è·ƒèº²é¿çš„æ°´å¹³æ¿€å…‰',
                icon: 'ğŸ”«'
            },
            BLADE: {
                name: 'æ—‹è½¬åˆ€åˆƒ',
                qteType: 'HOLD',
                damage: 1,
                description: 'éœ€è¦æ»‘é“²é€šè¿‡çš„æ—‹è½¬åˆ€åˆƒ',
                icon: 'âš”ï¸'
            },
            ELECTRIC: {
                name: 'ç”µå‡»åœ°æ¿',
                qteType: 'CLICK',
                damage: 1,
                description: 'éœ€è¦è·³è·ƒèº²é¿çš„å¸¦ç”µåœ°æ¿',
                icon: 'âš¡'
            }
        };

        // æœºå…³ç±»å‹å®šä¹‰
        const mechanismTypes = {
            DOOR: {
                name: 'ç”µå­é—¨',
                qteType: 'COMBO',
                description: 'éœ€è¦è¾“å…¥æ­£ç¡®åºåˆ—æ‰èƒ½å¼€å¯çš„é—¨',
                icon: 'ğŸšª'
            },
            BRIDGE: {
                name: 'ä¼¸ç¼©æ¡¥',
                qteType: 'HOLD',
                description: 'éœ€è¦æŒç»­æ¿€æ´»æ‰èƒ½é€šè¿‡çš„æ¡¥',
                icon: 'ğŸŒ‰'
            },
            TURRET: {
                name: 'è‡ªåŠ¨ç‚®å¡”',
                qteType: 'MASH',
                description: 'éœ€è¦å¿«é€Ÿè¾“å…¥æ‰èƒ½å…³é—­çš„ç‚®å¡”',
                icon: 'ğŸ”«'
            }
        };

        // æˆå°±ç³»ç»Ÿ
        const achievements = {
            FIRST_BLOOD: {
                name: 'ç¬¬ä¸€æ»´è¡€',
                description: 'å‡»è´¥ç¬¬ä¸€ä¸ªæ•Œäºº',
                icon: 'ğŸ©¸',
                condition: (stats) => stats.enemiesDefeated >= 1
            },
            COMBO_MASTER: {
                name: 'è¿å‡»å¤§å¸ˆ',
                description: 'è¾¾åˆ°10è¿å‡»',
                icon: 'ğŸ”¥',
                condition: (stats) => stats.maxCombo >= 10
            },
            PERFECT_RUN: {
                name: 'å®Œç¾é€šå…³',
                description: 'æ— ä¼¤å®Œæˆä¸€ä¸ªå…³å¡',
                icon: 'â­',
                condition: (stats) => stats.perfectRuns >= 1
            },
            QTE_MASTER: {
                name: 'QTEå¤§å¸ˆ',
                description: 'å®Œæˆ100ä¸ªQTE',
                icon: 'ğŸ®',
                condition: (stats) => stats.totalQTECompleted >= 100
            }
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            score: 0,
            health: 3,
            time: 60,
            skillUses: 0,
            active: false,
            level: 1,
            currentQTE: null,
            qteCompleted: 0,
            qteTotal: 0,
            bulletTimeActive: false,
            bulletTimeRemaining: 3,
            combo: 0,
            maxCombo: 0,
            enemiesDefeated: 0,
            trapsPassed: 0,
            mechanismsActivated: 0,
            totalQTECompleted: 0,
            perfectRuns: 0,
            currentEnvironment: null,
            unlockedAchievements: new Set()
        };

        // QTEçŠ¶æ€
        let qteState = {
            type: null,
            requiredKey: null,
            requiredKeys: [],
            timeWindow: 0,
            timeRemaining: 0,
            timer: null,
            mashCount: 0,
            mashTarget: 0,
            holdProgress: 0,
            holdTarget: 0,
            holdInterval: null,
            comboIndex: 0,
            comboSequence: []
        };

        // åˆå§‹åŒ–å‡½æ•°
        function initializeGame() {
            renderInputCards();
            updateStatusDisplay();
            setupEventListeners();
            updateComboDisplay();
            
            logMessage("æ¸¸æˆå·²åˆå§‹åŒ–ï¼Œå‡†å¤‡å¼€å§‹...", "system");
        }

        // æ¸²æŸ“è¾“å…¥å¡ç‰‡
        function renderInputCards() {
            const inputGrid = document.getElementById('input-grid');
            inputGrid.innerHTML = '';
            
            inputConfig.forEach(input => {
                const card = document.createElement('div');
                card.className = 'input-card';
                card.dataset.key = input.key;
                
                card.innerHTML = `
                    <div class="action-name">${input.name}</div>
                    <div class="key-display">${input.key}</div>
                    <div class="action-desc">${input.description}</div>
                `;
                
                inputGrid.appendChild(card);
            });
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            document.addEventListener('keydown', handleKeyPress);
            document.getElementById('start-level').addEventListener('click', startLevel);
            document.getElementById('next-level').addEventListener('click', nextLevel);
            document.getElementById('use-skill').addEventListener('click', useBulletTime);
        }

        // å¤„ç†æŒ‰é”®è¾“å…¥ - ä¿®å¤ç©ºæ ¼é”®æ»šåŠ¨é—®é¢˜
        function handleKeyPress(event) {
            // é˜»æ­¢ç©ºæ ¼é”®çš„é»˜è®¤è¡Œä¸ºï¼ˆé¡µé¢æ»šåŠ¨ï¼‰
            if (event.key === ' ') {
                event.preventDefault();
            }
            
            if (!gameState.active || !qteState.type) return;
            
            const key = event.key;
            let keyName = '';
            
            // æ ‡å‡†åŒ–æŒ‰é”®åç§°
            switch(key) {
                case ' ':
                    keyName = 'Space';
                    break;
                case 'Shift':
                    keyName = 'Shift';
                    // ä¸å¤„ç†Shifté”®ä½œä¸ºQTEè¾“å…¥
                    return;
                default:
                    keyName = key.toUpperCase();
            }
            
            // å¤„ç†æŠ€èƒ½æŒ‰é”®
            if (keyName === 'Shift') {
                useBulletTime();
                return;
            }
            
            // å¤„ç†QTEè¾“å…¥
            processQTEInput(keyName);
            
            // é«˜äº®æ˜¾ç¤ºè¢«æŒ‰ä¸‹çš„è¾“å…¥å¡ç‰‡
            highlightInputCard(keyName);
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('time').textContent = gameState.time;
            document.getElementById('skill-uses').textContent = gameState.skillUses;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('qte-completed').textContent = gameState.qteCompleted;
            document.getElementById('qte-count').textContent = gameState.qteTotal;
            document.getElementById('skill-count').textContent = 3 - gameState.skillUses;
            document.getElementById('enemies-defeated').textContent = gameState.enemiesDefeated;
            document.getElementById('traps-passed').textContent = gameState.trapsPassed;
            document.getElementById('mechanisms-activated').textContent = gameState.mechanismsActivated;
            document.getElementById('max-combo').textContent = gameState.maxCombo;
        }

        // æ›´æ–°è¿å‡»æ˜¾ç¤º
        function updateComboDisplay() {
            document.getElementById('combo-count').textContent = gameState.combo;
            const multiplier = 1 + (gameState.combo * 0.1);
            document.getElementById('combo-multiplier').textContent = `x${multiplier.toFixed(1)}`;
        }

        // å¼€å§‹å…³å¡
        function startLevel() {
            if (gameState.active) return;
            
            gameState.active = true;
            gameState.qteCompleted = 0;
            gameState.qteTotal = calculateQteCountForLevel();
            gameState.combo = 0;
            
            document.getElementById('start-level').disabled = true;
            document.getElementById('next-level').disabled = true;
            
            logMessage(`ç¬¬ ${gameState.level} å…³å¡å¼€å§‹ï¼éœ€è¦å®Œæˆ ${gameState.qteTotal} ä¸ªQTE`, "system");
            
            generateNextQTE();
        }

        // è®¡ç®—å½“å‰å…³å¡QTEæ•°é‡
        function calculateQteCountForLevel() {
            return 10 + (gameState.level * 2);
        }

        // ç”Ÿæˆä¸‹ä¸€ä¸ªQTE
        function generateNextQTE() {
            if (gameState.qteCompleted >= gameState.qteTotal) {
                levelComplete();
                return;
            }
            
            // æ¸…é™¤ä¹‹å‰çš„QTEçŠ¶æ€
            clearQTEState();
            
            // éšæœºé€‰æ‹©ç¯å¢ƒç±»å‹
            const environmentType = selectRandomEnvironmentType();
            gameState.currentEnvironment = environmentType;
            
            // æ ¹æ®ç¯å¢ƒç±»å‹é€‰æ‹©QTEç±»å‹
            const qteType = qteTypes[environmentType.qteType];
            qteState.type = qteType;
            
            // è®¾ç½®æ—¶é—´çª—å£
            const timeWindow = getRandomInRange(qteType.timeWindow.min, qteType.timeWindow.max);
            qteState.timeWindow = timeWindow;
            qteState.timeRemaining = timeWindow;
            
            // æ ¹æ®ç¯å¢ƒç±»å‹å’ŒQTEç±»å‹è®¾ç½®ç‰¹å®šå‚æ•°
            setupEnvironmentQTE(environmentType, qteType);
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateEnvironmentDisplay(environmentType);
            updateQteDisplay();
            
            // å¼€å§‹è®¡æ—¶
            startQTETimer();
            
            logMessage(`é‡åˆ°${environmentType.name}! ${getEnvironmentDescription(environmentType)}`, "system");
        }

        // éšæœºé€‰æ‹©ç¯å¢ƒç±»å‹
        function selectRandomEnvironmentType() {
            const environmentTypes = [...Object.values(enemyTypes), ...Object.values(trapTypes), ...Object.values(mechanismTypes)];
            return environmentTypes[Math.floor(Math.random() * environmentTypes.length)];
        }

        // æ ¹æ®ç¯å¢ƒç±»å‹è®¾ç½®QTE
        function setupEnvironmentQTE(environment, qteType) {
            const actionKeys = inputConfig.filter(input => input.type === 'action').map(input => input.key);
            
            switch(qteType.name) {
                case 'å•å‡»':
                    qteState.requiredKey = actionKeys[Math.floor(Math.random() * actionKeys.length)];
                    document.getElementById('qte-type').textContent = 'å•å‡»';
                    document.getElementById('qte-difficulty').textContent = 'ç®€å•';
                    break;
                    
                case 'è¿æ‰“':
                    qteState.requiredKey = actionKeys[Math.floor(Math.random() * actionKeys.length)];
                    qteState.mashTarget = Math.floor(getRandomInRange(qteTypes.MASH.requirements.min, qteTypes.MASH.requirements.max));
                    qteState.mashCount = 0;
                    document.getElementById('qte-type').textContent = 'è¿æ‰“';
                    document.getElementById('qte-difficulty').textContent = 'ä¸­ç­‰';
                    break;
                    
                case 'é•¿æŒ‰':
                    qteState.requiredKey = actionKeys[Math.floor(Math.random() * actionKeys.length)];
                    qteState.holdTarget = getRandomInRange(qteTypes.HOLD.requirements.min, qteTypes.HOLD.requirements.max);
                    qteState.holdProgress = 0;
                    document.getElementById('qte-type').textContent = 'é•¿æŒ‰';
                    document.getElementById('qte-difficulty').textContent = 'ä¸­ç­‰';
                    break;
                    
                case 'ç»„åˆé”®':
                    const keyCount = Math.floor(getRandomInRange(qteTypes.COMBO.requirements.min, qteTypes.COMBO.requirements.max));
                    qteState.comboSequence = [];
                    for (let i = 0; i < keyCount; i++) {
                        qteState.comboSequence.push(actionKeys[Math.floor(Math.random() * actionKeys.length)]);
                    }
                    qteState.comboIndex = 0;
                    document.getElementById('qte-type').textContent = 'ç»„åˆé”®';
                    document.getElementById('qte-difficulty').textContent = 'å›°éš¾';
                    break;
            }
        }

        // æ›´æ–°ç¯å¢ƒæ˜¾ç¤º
        function updateEnvironmentDisplay(environment) {
            const environmentDisplay = document.getElementById('environment-display');
            environmentDisplay.innerHTML = '';
            
            let displayHTML = '';
            
            if (Object.values(enemyTypes).includes(environment)) {
                displayHTML = `
                    <div class="enemy-display">
                        <div class="enemy-icon">${environment.icon}</div>
                        <div class="enemy-info">
                            <div class="enemy-name">${environment.name}</div>
                            <div class="enemy-desc">${environment.description}</div>
                            <div class="enemy-health">
                                <div class="enemy-health-fill" style="width: ${(environment.health / environment.health) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (Object.values(trapTypes).includes(environment)) {
                displayHTML = `
                    <div class="trap-display">
                        <div class="trap-icon">${environment.icon}</div>
                        <div class="trap-info">
                            <div class="trap-name">${environment.name}</div>
                            <div class="trap-desc">${environment.description}</div>
                            <div class="environment-effects">
                                <div class="environment-effect">ä¼¤å®³: ${environment.damage}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (Object.values(mechanismTypes).includes(environment)) {
                displayHTML = `
                    <div class="trap-display">
                        <div class="trap-icon">${environment.icon}</div>
                        <div class="trap-info">
                            <div class="trap-name">${environment.name}</div>
                            <div class="trap-desc">${environment.description}</div>
                        </div>
                    </div>
                `;
            }
            
            environmentDisplay.innerHTML = displayHTML;
        }

        // è·å–ç¯å¢ƒæè¿°
        function getEnvironmentDescription(environment) {
            if (Object.values(enemyTypes).includes(environment)) {
                return `å‡»è´¥ ${environment.name} è·å¾— ${environment.score} åˆ†`;
            } else if (Object.values(trapTypes).includes(environment)) {
                return `èº²é¿ ${environment.name} é¿å…å—åˆ° ${environment.damage} ç‚¹ä¼¤å®³`;
            } else if (Object.values(mechanismTypes).includes(environment)) {
                return `æ¿€æ´» ${environment.name} ç»§ç»­å‰è¿›`;
            }
            return '';
        }

        // æ›´æ–°QTEæ˜¾ç¤º
        function updateQteDisplay() {
            const qtePrompt = document.getElementById('qte-prompt');
            const specificDisplay = document.getElementById('qte-specific-display');
            
            // æ›´æ–°æç¤ºä¿¡æ¯
            qtePrompt.textContent = getQtePrompt(qteState.type);
            
            // æ ¹æ®QTEç±»å‹æ›´æ–°ç‰¹å®šæ˜¾ç¤º
            specificDisplay.innerHTML = '';
            
            switch(qteState.type.name) {
                case 'å•å‡»':
                    specificDisplay.innerHTML = `
                        <div class="qte-requirements">
                            <div class="qte-requirement">æŒ‰é”®: ${qteState.requiredKey}</div>
                            <div class="qte-requirement">æ—¶é—´: ${qteState.timeWindow.toFixed(1)}ç§’</div>
                        </div>
                    `;
                    break;
                    
                case 'è¿æ‰“':
                    specificDisplay.innerHTML = `
                        <div class="qte-mash-counter">${qteState.mashCount}/${qteState.mashTarget}</div>
                        <div class="qte-requirements">
                            <div class="qte-requirement">æŒ‰é”®: ${qteState.requiredKey}</div>
                            <div class="qte-requirement">ç›®æ ‡: ${qteState.mashTarget}æ¬¡</div>
                            <div class="qte-requirement">æ—¶é—´: ${qteState.timeWindow.toFixed(1)}ç§’</div>
                        </div>
                    `;
                    break;
                    
                case 'é•¿æŒ‰':
                    specificDisplay.innerHTML = `
                        <div class="qte-hold-progress">
                            <div class="qte-hold-fill" id="qte-hold-fill" style="width: 0%"></div>
                        </div>
                        <div class="qte-requirements">
                            <div class="qte-requirement">æŒ‰é”®: ${qteState.requiredKey}</div>
                            <div class="qte-requirement">ç›®æ ‡: ${qteState.holdTarget.toFixed(1)}ç§’</div>
                        </div>
                    `;
                    break;
                    
                case 'ç»„åˆé”®':
                    const comboKeysHTML = qteState.comboSequence.map((key, index) => {
                        const className = index === qteState.comboIndex ? 'qte-combo-key active' : 
                                        index < qteState.comboIndex ? 'qte-combo-key completed' : 'qte-combo-key';
                        return `<div class="${className}">${key}</div>`;
                    }).join('');
                    
                    specificDisplay.innerHTML = `
                        <div class="qte-combo-sequence">
                            ${comboKeysHTML}
                        </div>
                        <div class="qte-requirements">
                            <div class="qte-requirement">æ—¶é—´: ${qteState.timeWindow.toFixed(1)}ç§’</div>
                        </div>
                    `;
                    break;
            }
        }

        // è·å–QTEæç¤ºä¿¡æ¯
        function getQtePrompt(qteType) {
            switch(qteType.name) {
                case 'å•å‡»': return `å¿«é€ŸæŒ‰ä¸‹ ${qteState.requiredKey} é”®`;
                case 'è¿æ‰“': return `å¿«é€Ÿè¿ç»­æŒ‰ä¸‹ ${qteState.requiredKey} é”® ${qteState.mashTarget} æ¬¡`;
                case 'é•¿æŒ‰': return `æŒ‰ä½ ${qteState.requiredKey} é”® ${qteState.holdTarget.toFixed(1)} ç§’`;
                case 'ç»„åˆé”®': return `æŒ‰é¡ºåºæŒ‰ä¸‹æŒ‡å®šæŒ‰é”®`;
                default: return 'æœªçŸ¥QTEç±»å‹';
            }
        }

        // å¼€å§‹QTEè®¡æ—¶å™¨
        function startQTETimer() {
            const timerFill = document.getElementById('qte-timer-fill');
            const timeScale = gameState.bulletTimeActive ? 0.5 : 1.0;
            
            qteState.timer = setInterval(() => {
                qteState.timeRemaining -= 0.1;
                const percentage = (qteState.timeRemaining / qteState.timeWindow) * 100;
                timerFill.style.width = `${percentage}%`;
                
                // æ”¹å˜é¢œè‰²åŸºäºå‰©ä½™æ—¶é—´
                if (percentage > 50) {
                    timerFill.style.background = 'linear-gradient(90deg, #6ee2ff, #8a8aff)';
                } else if (percentage > 25) {
                    timerFill.style.background = 'linear-gradient(90deg, #ffcc66, #ffaa33)';
                } else {
                    timerFill.style.background = 'linear-gradient(90deg, #ff6e6e, #ff3333)';
                }
                
                if (qteState.timeRemaining <= 0) {
                    qteFailure("æ—¶é—´åˆ°!");
                }
            }, 100 * timeScale);
        }

        // å¤„ç†QTEè¾“å…¥
        function processQTEInput(key) {
            switch(qteState.type.name) {
                case 'å•å‡»':
                    if (key === qteState.requiredKey) {
                        qteSuccess();
                    } else {
                        qteFailure(`æŒ‰é”™äº†é”®! åº”è¯¥æ˜¯ ${qteState.requiredKey}`);
                    }
                    break;
                    
                case 'è¿æ‰“':
                    if (key === qteState.requiredKey) {
                        qteState.mashCount++;
                        updateQteDisplay();
                        
                        if (qteState.mashCount >= qteState.mashTarget) {
                            qteSuccess();
                        }
                    } else {
                        qteFailure(`æŒ‰é”™äº†é”®! åº”è¯¥æ˜¯ ${qteState.requiredKey}`);
                    }
                    break;
                    
                case 'é•¿æŒ‰':
                    if (key === qteState.requiredKey) {
                        // å¼€å§‹é•¿æŒ‰è®¡æ—¶
                        if (!qteState.holdInterval) {
                            qteState.holdInterval = setInterval(() => {
                                qteState.holdProgress += 0.1;
                                const percentage = (qteState.holdProgress / qteState.holdTarget) * 100;
                                document.getElementById('qte-hold-fill').style.width = `${Math.min(percentage, 100)}%`;
                                
                                if (qteState.holdProgress >= qteState.holdTarget) {
                                    qteSuccess();
                                }
                            }, 100);
                        }
                    } else {
                        qteFailure(`æŒ‰é”™äº†é”®! åº”è¯¥æ˜¯ ${qteState.requiredKey}`);
                    }
                    break;
                    
                case 'ç»„åˆé”®':
                    if (key === qteState.comboSequence[qteState.comboIndex]) {
                        qteState.comboIndex++;
                        updateQteDisplay();
                        
                        if (qteState.comboIndex >= qteState.comboSequence.length) {
                            qteSuccess();
                        }
                    } else {
                        qteFailure(`æŒ‰é”™äº†é”®! åº”è¯¥æ˜¯ ${qteState.comboSequence[qteState.comboIndex]}`);
                    }
                    break;
            }
        }

        // QTEæˆåŠŸ
        function qteSuccess() {
            clearQTEState();
            gameState.qteCompleted++;
            gameState.totalQTECompleted++;
            gameState.combo++;
            
            if (gameState.combo > gameState.maxCombo) {
                gameState.maxCombo = gameState.combo;
            }
            
            // è®¡ç®—å¾—åˆ†ï¼ˆè€ƒè™‘è¿å‡»åŠ æˆï¼‰
            const baseScore = 10;
            const comboMultiplier = 1 + (gameState.combo * 0.1);
            const scoreEarned = Math.floor(baseScore * comboMultiplier);
            
            gameState.score += scoreEarned;
            
            // æ ¹æ®ç¯å¢ƒç±»å‹å¤„ç†é¢å¤–æ•ˆæœ
            const environment = gameState.currentEnvironment;
            if (Object.values(enemyTypes).includes(environment)) {
                gameState.enemiesDefeated++;
                logMessage(`å‡»è´¥ ${environment.name}! +${scoreEarned}åˆ† (è¿å‡»x${comboMultiplier.toFixed(1)})`, "success");
                createDamagePopup(environment.score, document.querySelector('.enemy-display'));
            } else if (Object.values(trapTypes).includes(environment)) {
                gameState.trapsPassed++;
                logMessage(`æˆåŠŸèº²é¿ ${environment.name}! +${scoreEarned}åˆ† (è¿å‡»x${comboMultiplier.toFixed(1)})`, "success");
            } else if (Object.values(mechanismTypes).includes(environment)) {
                gameState.mechanismsActivated++;
                logMessage(`æˆåŠŸæ¿€æ´» ${environment.name}! +${scoreEarned}åˆ† (è¿å‡»x${comboMultiplier.toFixed(1)})`, "success");
            }
            
            updateStatusDisplay();
            updateComboDisplay();
            checkAchievements();
            
            // çŸ­æš‚å»¶è¿Ÿåç”Ÿæˆä¸‹ä¸€ä¸ªQTE
            setTimeout(() => {
                generateNextQTE();
            }, 1000);
        }

        // QTEå¤±è´¥
        function qteFailure(reason) {
            clearQTEState();
            gameState.health--;
            gameState.combo = 0;
            
            // æ ¹æ®ç¯å¢ƒç±»å‹å¤„ç†å¤±è´¥æ•ˆæœ
            const environment = gameState.currentEnvironment;
            if (Object.values(enemyTypes).includes(environment)) {
                logMessage(`è¢« ${environment.name} æ”»å‡»! ${reason} -1ç”Ÿå‘½å€¼`, "failure");
            } else if (Object.values(trapTypes).includes(environment)) {
                logMessage(`è§¦å‘ ${environment.name}! ${reason} -1ç”Ÿå‘½å€¼`, "failure");
            } else if (Object.values(mechanismTypes).includes(environment)) {
                logMessage(`${environment.name} æ¿€æ´»å¤±è´¥! ${reason} -1ç”Ÿå‘½å€¼`, "failure");
            }
            
            updateStatusDisplay();
            updateComboDisplay();
            
            if (gameState.health <= 0) {
                gameOver();
                return;
            }
            
            // çŸ­æš‚å»¶è¿Ÿåç”Ÿæˆä¸‹ä¸€ä¸ªQTE
            setTimeout(() => {
                generateNextQTE();
            }, 1000);
        }

        // åˆ›å»ºä¼¤å®³å¼¹å‡ºæ•ˆæœ
        function createDamagePopup(amount, element) {
            const popup = document.createElement('div');
            popup.className = 'damage-popup';
            popup.textContent = `+${amount}`;
            
            const rect = element.getBoundingClientRect();
            popup.style.left = `${rect.left + rect.width / 2}px`;
            popup.style.top = `${rect.top}px`;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                document.body.removeChild(popup);
            }, 1000);
        }

        // æ¸…é™¤QTEçŠ¶æ€
        function clearQTEState() {
            if (qteState.timer) {
                clearInterval(qteState.timer);
                qteState.timer = null;
            }
            
            if (qteState.holdInterval) {
                clearInterval(qteState.holdInterval);
                qteState.holdInterval = null;
            }
            
            // é‡ç½®QTEçŠ¶æ€
            qteState = {
                type: null,
                requiredKey: null,
                requiredKeys: [],
                timeWindow: 0,
                timeRemaining: 0,
                timer: null,
                mashCount: 0,
                mashTarget: 0,
                holdProgress: 0,
                holdTarget: 0,
                holdInterval: null,
                comboIndex: 0,
                comboSequence: []
            };
        }

        // ä½¿ç”¨å­å¼¹æ—¶é—´æŠ€èƒ½
        function useBulletTime() {
            if (gameState.skillUses >= 3 || gameState.bulletTimeActive) return;
            
            gameState.skillUses++;
            gameState.bulletTimeActive = true;
            
            logMessage("å­å¼¹æ—¶é—´æ¿€æ´»! QTEæ—¶é—´å‡æ…¢50%", "skill");
            updateStatusDisplay();
            
            // å­å¼¹æ—¶é—´æŒç»­3ç§’
            setTimeout(() => {
                gameState.bulletTimeActive = false;
                logMessage("å­å¼¹æ—¶é—´ç»“æŸ", "system");
            }, 3000);
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievements() {
            for (const [key, achievement] of Object.entries(achievements)) {
                if (!gameState.unlockedAchievements.has(key) && achievement.condition(gameState)) {
                    unlockAchievement(key, achievement);
                }
            }
        }

        // è§£é”æˆå°±
        function unlockAchievement(key, achievement) {
            gameState.unlockedAchievements.add(key);
            
            // æ˜¾ç¤ºæˆå°±å¼¹çª—
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">æˆå°±è§£é”!</div>
                <div class="achievement-desc">${achievement.name} - ${achievement.description}</div>
            `;
            
            document.body.appendChild(popup);
            
            // 3ç§’åç§»é™¤å¼¹çª—
            setTimeout(() => {
                document.body.removeChild(popup);
            }, 3000);
            
            logMessage(`æˆå°±è§£é”: ${achievement.name} - ${achievement.description}`, "achievement");
        }

        // å…³å¡å®Œæˆ
        function levelComplete() {
            gameState.active = false;
            gameState.level++;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå®Œç¾é€šå…³ï¼ˆæ— ä¼¤ï¼‰
            if (gameState.health === 3) {
                gameState.perfectRuns++;
                logMessage("å®Œç¾é€šå…³! æ— ä¼¤å®Œæˆå…³å¡", "success");
                checkAchievements();
            }
            
            const levelBonus = gameState.level * 50;
            gameState.score += levelBonus;
            
            logMessage(`å…³å¡å®Œæˆ! è·å¾—å…³å¡å¥–åŠ±: +${levelBonus}åˆ†`, "success");
            updateStatusDisplay();
            
            document.getElementById('start-level').disabled = false;
            document.getElementById('next-level').disabled = false;
        }

        // ä¸‹ä¸€å…³å¡
        function nextLevel() {
            startLevel();
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameState.active = false;
            logMessage("æ¸¸æˆç»“æŸ! ç”Ÿå‘½å€¼è€—å°½", "failure");
            
            document.getElementById('start-level').disabled = false;
            document.getElementById('next-level').disabled = true;
        }

        // é«˜äº®æ˜¾ç¤ºè¢«æŒ‰ä¸‹çš„è¾“å…¥å¡ç‰‡
        function highlightInputCard(key) {
            const cards = document.querySelectorAll('.input-card');
            cards.forEach(card => {
                if (card.dataset.key === key) {
                    card.style.backgroundColor = 'rgba(80, 80, 160, 0.9)';
                    card.style.borderColor = '#8a8aff';
                    
                    setTimeout(() => {
                        card.style.backgroundColor = '';
                        card.style.borderColor = '';
                    }, 300);
                }
            });
        }

        // æ·»åŠ æ—¥å¿—æ¶ˆæ¯
        function logMessage(message, type = 'system') {
            const outputLog = document.getElementById('output-log');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const now = new Date();
            const timeString = `${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            let typeClass = '';
            if (type === 'success') typeClass = 'log-success';
            if (type === 'failure') typeClass = 'log-failure';
            if (type === 'skill') typeClass = 'log-skill';
            if (type === 'achievement') typeClass = 'log-achievement';
            
            logEntry.innerHTML = `
                <span class="log-time">[${timeString}]</span>
                <span class="${typeClass}">${message}</span>
            `;
            
            outputLog.appendChild(logEntry);
            outputLog.scrollTop = outputLog.scrollHeight;
        }

        // è·å–éšæœºèŒƒå›´å†…çš„å€¼
        function getRandomInRange(min, max) {
            return min + Math.random() * (max - min);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initializeGame;
    </script>
</body>
</html>